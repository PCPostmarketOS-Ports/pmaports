# Forked from Alpine to avoid resetting during modem upgrade

pkgname=eg25-manager
pkgver=9999
_pkgver="0.4.2"
pkgrel=0
pkgdesc="Daemon for managing the Quectel EG25 modem"
url="https://gitlab.com/mobian1/devices/eg25-manager"
# s390x, mips64 and riscv64 blocked by polkit -> modemmanager
arch="all !s390x !mips64 !riscv64"
license="GPL-3.0-or-later"
makedepends="
	curl-dev
	glib-dev
	libgpiod-dev
	libgudev-dev
	libusb-dev
	meson
	modemmanager-dev
	"
source="
	https://gitlab.com/mobian1/devices/eg25-manager/-/archive/$_pkgver/eg25-manager-$_pkgver.tar.gz
	eg25-manager.confd
	eg25-manager.initd
	0001-udev-cancel-reset-if-modem-is-already-back.patch
	"
options="!check"  # no tests
subpackages="$pkgname-openrc"
builddir="$srcdir/$pkgname-$_pkgver"

build() {
	abuild-meson . output
	meson compile ${JOBS:+-j ${JOBS}} -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
	install -Dm755 "$srcdir"/eg25-manager.initd "$pkgdir"/etc/init.d/eg25-manager
	install -Dm644 "$srcdir"/eg25-manager.confd "$pkgdir"/etc/conf.d/eg25-manager
}

sha512sums="
a29df6bce2c1731cb96a0be8d63d333fb7f851de7d30b8f9c9e591a984926ecf1730f8680b1e78a6a5416a37499cc6e7951e3d92952315e65223be70e0aec9b6  eg25-manager-0.4.2.tar.gz
55936830afad2968a214fb39cfe1a9db50421dc2ff4f67d04f08f6bd2b094c3ab46799cfc7743bbc5032682d98d1216203adf5264353a05134bea58524ac070b  eg25-manager.confd
6422ffb1014fee5315fbc82f811471e9bdef7e6bfedfd97c9e1928ff5dd2c761df8d3c54c05e132063365861e224cf344500ae6809fd2172795f48c7b6b483c8  eg25-manager.initd
a2a2fe2418cf92dfc68cc98e0d368b9a6ab995059f9cdd209ffe3db88d9afe717e82fe489f6332ade9a307d126a146aca1147f43fcc87ff4e4454b5e43da47fa  0001-udev-cancel-reset-if-modem-is-already-back.patch
"
