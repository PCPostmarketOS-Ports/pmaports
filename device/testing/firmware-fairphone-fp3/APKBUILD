pkgname=firmware-fairphone-fp3
pkgver=20210805
_commit="a46fb8c68fbe18c40eb138fc754e263aa6ece5ad"
pkgrel=0
pkgdesc="Firmware for Fairphone 3"
url="https://github.com/FairBlobs/FP3-firmware"
arch="aarch64"
license="proprietary"
subpackages="$pkgname-adreno $pkgname-wcnss"
options="!check !strip !archcheck !tracedeps pmb:cross-native"
source="https://github.com/FairBlobs/FP3-firmware/archive/$_commit/$pkgname-$_commit.tar.gz"
builddir="$srcdir/FP3-firmware-$_commit"
_fwdir="/lib/firmware/postmarketos"

package() {
	mkdir -p "$pkgdir"
}

adreno() {
	pkgdesc="Fairphone 3 firmware for GPU"

	install -Dm644 "$builddir"/a506_zap.mdt -t \
		"$subpkgdir/$_fwdir"
	install -Dm644 "$builddir"/a506_zap.b* -t \
		"$subpkgdir/$_fwdir"
}

wcnss() {
	pkgdesc="Fairphone 3 firmware for the Qualcomm Wireless Connectivity Subsystem (WCNSS)"

	install -Dm644 "$builddir"/wlan/prima/* -t \
		"$subpkgdir/$_fwdir"/wlan/prima
}

sha512sums="
5cdae1c05f68689f6d258ac16faccb6733d0841f8bc22a0ce8c602a44fa1ada69b6b2158970685ad12b0a1e9dfe30e5c140223257b971a64eae36bad71954ceb  firmware-fairphone-fp3-a46fb8c68fbe18c40eb138fc754e263aa6ece5ad.tar.gz
"
